# ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î - 16 ‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô 2568

## üêõ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. ‚ùå SQLSTATE[42S22]: Column not found - Unknown column 'po_date'
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** API ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå `po_date` ‡πÅ‡∏ï‡πà‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ä‡πâ `order_date`

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:** 
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `po_date` ‚Üí `order_date` ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `api/purchase_order_new_product_api.php`
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á INSERT:
  - `po_status` ‚Üí `status`
  - `created_by` ‚Üí `ordered_by`
  - `po_remark` ‚Üí `remark`

**‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** `api/purchase_order_new_product_api.php`

```php
// Before:
INSERT INTO purchase_orders (supplier_id, po_date, po_status, created_by, po_remark, currency_id)

// After:
INSERT INTO purchase_orders (supplier_id, order_date, status, ordered_by, remark, currency_id)
```

---

### 2. ‚ùå ‡∏•‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (Discount)
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡∏•‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå `po_item_discount` ‡∏à‡∏≤‡∏Å purchase_order_items
- ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì discount ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì item_amount
- ‡∏•‡∏ö HTML input discount ‡∏à‡∏≤‡∏Å addItemRow()
- ‡∏•‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á discount ‡∏à‡∏≤‡∏Å calculateTotal()

**‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
1. `api/purchase_order_new_product_api.php`
   - ‡∏•‡∏ö `$discounts = $_POST['discount'] ?? [];`
   - ‡∏•‡∏ö `$discount = (float)($discounts[$i] ?? 0);`
   - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `$item_amount = $item_total - $item_discount;` ‚Üí `$item_amount = $item_total;`
   - ‡∏•‡∏ö `po_item_discount` ‡∏à‡∏≤‡∏Å INSERT statement

2. `orders/purchase_order_create_new_product.php`
   - ‡∏•‡∏ö HTML discount input
   - ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì discount ‡πÉ‡∏ô calculateTotal()
   - ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï grid columns ‡∏à‡∏≤‡∏Å 8 ‡πÄ‡∏õ‡πá‡∏ô 7 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå

---

### 3. ‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö Real-time
**‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà:** ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏à‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:**
- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà dropdown
- ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

**‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** `orders/purchase_order_create_new_product.php`

**‡πÇ‡∏Ñ‡πâ‡∏î:**
```javascript
// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô
document.getElementById('currency_id').addEventListener('change', function() {
    calculateTotal();
});

// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï calculateTotal() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
function calculateTotal() {
    const currencySymbol = document.querySelector('#currency_id option:checked')?.getAttribute('data-symbol') || '‡∏ø';
    document.getElementById('subtotal').textContent = currencySymbol + ' ' + subtotal.toFixed(2);
    document.getElementById('total').textContent = currencySymbol + ' ' + subtotal.toFixed(2);
}
```

---

### 4. üìä ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ï‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
**‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå:** ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÄ‡∏ä‡πà‡∏ô ‡∏ø, $, ‚Ç¨

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
- THB (‡∏ö‡∏≤‡∏ó) ‚Üí ‡∏ø 5,000.00
- USD (‡∏î‡∏≠‡∏•‡∏•‡∏≤‡∏£‡πå) ‚Üí $ 150.00
- EUR (‡∏¢‡∏π‡πÇ‡∏£) ‚Üí ‚Ç¨ 120.00

**‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** `orders/purchase_order_create_new_product.php`

---

## üìù ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. `api/purchase_order_new_product_api.php`
**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:**
- ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `po_date` ‚Üí `order_date`
- ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `po_status` ‚Üí `status`
- ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `created_by` ‚Üí `ordered_by`
- ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `po_remark` ‚Üí `remark`
- ‚úÖ ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `$discounts`
- ‚úÖ ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì discount
- ‚úÖ ‡∏•‡∏ö `po_item_discount` ‡∏à‡∏≤‡∏Å INSERT
- ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `total_amount_base` ‚Üí `total_amount`

### 2. `orders/purchase_order_create_new_product.php`
**‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:**
- ‚úÖ ‡∏•‡∏ö HTML discount input ‡∏à‡∏≤‡∏Å addItemRow()
- ‚úÖ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï grid columns ‡∏à‡∏≤‡∏Å 8 ‡πÄ‡∏õ‡πá‡∏ô 7
- ‚úÖ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï calculateTotal() ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô
- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö currency_id change
- ‚úÖ ‡∏î‡∏∂‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å data-symbol

---

## ‚úÖ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

### Before (‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ)
```
‚ùå SQLSTATE[42S22]: Column not found: 1054 Unknown column 'po_date'
‚ùå ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏¥‡∏î (‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î)
‚ùå ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô ‡∏ø ‡πÄ‡∏™‡∏°‡∏≠ (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô)
```

### After (‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ)
```
‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PO ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
‚úÖ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î)
‚úÖ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
```

---

## üéØ Layout Grid Updates

### ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ (8 columns)
```
[Image] [Name] [Category] [Unit] [Qty] [Price] [Discount] [Delete]
```

### ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ (7 columns)
```
[Image] [Name] [Category] [Unit] [Qty] [Price] [Delete]
```

---

## üìä Database Fields Mapping

| ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Frontend | ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó |
|---|---|---|
| po_number | po_number | VARCHAR(20) |
| order_date | order_date | DATETIME |
| status | status | ENUM |
| ordered_by | ordered_by | INT |
| remark | remark | TEXT |
| currency_id | currency_id | INT |
| total_amount | total_amount | DECIMAL |

---

## üß™ Testing

### Test Case 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö PO ‡πÉ‡∏´‡∏°‡πà
```
‚úì ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PO
‚úì ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î)
‚úì ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
‚úì ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° = quantity √ó price (‡πÑ‡∏°‡πà‡∏°‡∏µ discount)
‚úì ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
```

### Test Case 2: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô
```
‚úì ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô THB ‚Üí ‡∏ø 5,000.00
‚úì ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô USD ‚Üí $ 5,000.00
‚úì ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô EUR ‚Üí ‚Ç¨ 5,000.00
‚úì ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
```

---

## üìã Checklist

- [x] ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç po_date error
- [x] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï column names ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö DB
- [x] ‡∏•‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå discount
- [x] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô
- [x] ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ï‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô
- [x] ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï CSS grid layout
- [x] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
- [x] ‡πÑ‡∏°‡πà‡∏°‡∏µ error

---

**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:** ‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 16 ‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô 2568

**‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô:** 1.1
