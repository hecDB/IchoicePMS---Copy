# 📦 ระบบบันทึกสินค้าสูญหาย - คู่มือการใช้งาน

## 🎯 ที่มาของระบบ
ระบบนี้ถูกสร้างขึ้นเพื่อบันทึกและติดตามสินค้าที่หาไม่เจอหรือสูญหายในคลัง เพื่อให้ระบบ stock count ถูกต้อง

---

## 🚀 เริ่มต้นใช้งาน

### ขั้นตอน 1: ติดตั้งฐานข้อมูล
เข้าไปที่ URL นี้เพื่อสร้างตาราง:
```
http://ichoice.local/setup_missing_products_table.php
```
จะเห็นข้อความ: ✓ ตารางถูกสร้างหรือมีอยู่แล้ว

### ขั้นตอน 2: เข้าสู่หน้าบันทึกสินค้าสูญหาย
```
http://ichoice.local/stock/missing_products.php
```

---

## 📝 ขั้นตอนการบันทึกสินค้าสูญหาย

### ขั้นตอน 1️⃣ : แสกนบาร์โค้ด / พิมพ์ SKU

```
┌─────────────────────────────────┐
│ ขั้นตอน 1: แสกนบาร์โค้ด         │
│                                 │
│ [🔍 แสกนบาร์โค้ด หรือพิมพ์...] │
└─────────────────────────────────┘
```

**วิธีการ:**
- คลิกที่ช่องค้นหา
- แสกนบาร์โค้ด หรือ พิมพ์:
  - บาร์โค้ด เช่น: `1234567890123`
  - SKU เช่น: `SKU001`, `PROD-123`
  - ชื่อสินค้า เช่น: `กระดาษ A4`, `ปากกา`

**Hotkey:** กดปุ่ม `/` ได้ด้วย (เพื่อ focus ไปที่ช่องค้นหา)

### ขั้นตอน 2️⃣ : เลือกสินค้า

```
ผลลัพธ์การค้นหา:
┌─────────────────────────────┐
│ 📷 ชื่อสินค้า              │
│    SKU: SKU001             │
│    Barcode: 1234567890123  │  ← คลิกที่นี่
└─────────────────────────────┘

┌─────────────────────────────┐
│ 📷 ชื่ออื่น                 │
│    SKU: SKU002             │
│    Barcode: 2234567890123  │
└─────────────────────────────┘
```

**ผลลัพธ์:** เมื่อเลือก ระบบจะแสดง:

```
┌──────────────────────────────┐
│ ขั้นตอน 2: สินค้าที่เลือก   │
│                              │
│ ✓ 📷                         │
│ ชื่อสินค้า: ปากกา          │
│ SKU: SKU001                 │
│ บาร์โค้ด: 1234567890123    │
└──────────────────────────────┘
```

### ขั้นตอน 3️⃣ : กรอกจำนวนที่สูญหาย

```
┌──────────────────────────────┐
│ ขั้นตอน 3: กรอกจำนวน        │
│                              │
│ จำนวนที่สูญหาย: [  5  ] ชิ้น │
│                              │
│ หมายเหตุ:                    │
│ ┌──────────────────────────┐ │
│ │ หาไม่เจอในตู้เก็บ        │ │
│ │ (ทั้งหรือแต่ละบรรจุภัณฑ์ │ │
│ └──────────────────────────┘ │
└──────────────────────────────┘
```

**ตัวอย่างหมายเหตุ:**
- "หาไม่เจอในตู้เก็บ"
- "ชำรุด/เสียหาย"
- "ตกหล่นระหว่างจัดเก็บ"
- "ระบบนับผิด"
- "เสื่อมสภาพไม่ได้ใช้"

### ขั้นตอน 4️⃣ : บันทึก

```
┌────────────────────────────────────┐
│  ✓ บันทึกสินค้าสูญหาย              │  ← คลิก
└────────────────────────────────────┘
```

**ผลลัพธ์:**
- ✅ ข้อความยืนยัน: "บันทึกสินค้าสูญหายสำเร็จ"
- 📊 ระบบอัตโนมัติ:
  1. บันทึก 5 ชิ้น ลงใน missing_products table
  2. สร้าง transaction ลบ -5 ชิ้น ออกจากสต็อก
  3. ปรับปรุง stock count
  4. บันทึกผู้ที่รายงาน และ เวลา

### ขั้นตอน 5️⃣ : ดูรายการวันนี้

```
┌────────────────────────────────────────────────────┐
│ รายการสินค้าสูญหายวันนี้                           │
├────────────────────────────────────────────────────┤
│ ลำดับ │ สินค้า  │ จำนวน │ บันทึกโดย │ เวลา       │
├───────┼─────────┼───────┼───────────┼────────────┤
│  1    │ ปากกา   │   5   │ admin     │ 14:30     │
│  2    │ กระดาษ  │   2   │ staff1    │ 15:45     │
└────────────────────────────────────────────────────┘
```

---

## 📊 ดูรายการสินค้าสูญหาย

เข้าไปที่:
```
http://ichoice.local/stock/missing_products_list.php
```

**ข้อมูลที่แสดง:**
- 📈 สถิติ:
  - ทั้งหมด: จำนวนรายการสูญหายทั้งหมด
  - วันนี้: จำนวนรายการวันนี้
  - สัปดาห์นี้: รายการ 7 วันที่ผ่านมา
  - จำนวนรวม: ปริมาณทั้งหมด

- 📋 ตารางแสดง:
  - เลขที่
  - ชื่อสินค้า
  - SKU / บาร์โค้ด
  - จำนวนที่สูญหาย
  - หมายเหตุ
  - ผู้บันทึก
  - วันที่และเวลา
  - ปุ่มลบ

**ฟังก์ชันเพิ่มเติม:**
- 🔍 ค้นหา (ด้านบน)
- 📊 จัดเรียง (คลิกที่หัวคอลัมน์)
- 🗑️ ลบรายการ (คลิกปุ่มลบ)

---

## 🔄 ระบบ Behind the Scenes

### เมื่อบันทึกสินค้าสูญหาย ระบบทำงาน:

1. **บันทึกในตาราง `missing_products`**
   ```
   missing_id: 1
   product_id: 1
   sku: SKU001
   barcode: 1234567890123
   product_name: ปากกา
   quantity_missing: 5
   remark: หาไม่เจอในตู้เก็บ
   reported_by: 1 (user_id)
   created_at: 2025-11-20 14:30:00
   ```

2. **สร้าง Transaction ในตาราง `receive_items`**
   ```
   item_id: 1
   po_id: 0
   receive_qty: -5 (ลบออกจากสต็อก)
   remark: "สินค้าสูญหาย (Missing ID: 1) - หาไม่เจอในตู้เก็บ"
   created_by: 1
   created_at: 2025-11-20 14:30:00
   ```

3. **ผลกระทบต่อ Stock Count**
   ```
   Stock เดิม:   100 ชิ้น
   สูญหาย:        -5 ชิ้น
   ───────────────────
   Stock ใหม่:    95 ชิ้น
   ```

### เมื่อลบรายการสูญหาย:
1. ลบจาก `missing_products`
2. ลบ transaction ที่เกี่ยวข้องจาก `receive_items`
3. คืนค่า stock กลับมา

---

## 🛠️ ข้อมูล API

### 1. ค้นหาสินค้า
```
GET /api/missing_product_search_api.php?q=ปากกา

Response:
{
  "success": true,
  "results": [
    {
      "product_id": 1,
      "sku": "SKU001",
      "barcode": "1234567890123",
      "product_name": "ปากกา"
    }
  ]
}
```

### 2. บันทึกสินค้าสูญหาย
```
POST /api/record_missing_product_api.php

Data:
- product_id: 1
- quantity_missing: 5
- remark: หมายเหตุ
- reported_by: 1

Response:
{
  "success": true,
  "missing_id": 1,
  "product_name": "ปากกา",
  "quantity": 5
}
```

### 3. ดูรายการ
```
GET /api/get_missing_products_api.php?date=2025-11-20&limit=50

Response:
{
  "success": true,
  "count": 5,
  "data": [...]
}
```

### 4. ลบรายการ
```
POST /api/delete_missing_product_api.php

Data:
- missing_id: 1

Response:
{
  "success": true,
  "message": "ลบรายการสูญหายสำเร็จ"
}
```

---

## ✅ Checklist การใช้งาน

- [ ] รัน setup_missing_products_table.php
- [ ] เข้าสู่ระบบ
- [ ] ไปที่ /stock/missing_products.php
- [ ] ค้นหาสินค้า (แสกน/พิมพ์)
- [ ] เลือกสินค้า
- [ ] กรอกจำนวนสูญหาย
- [ ] เพิ่มหมายเหตุ (ถ้าจำเป็น)
- [ ] คลิก "บันทึก"
- [ ] ตรวจสอบรายการใน missing_products_list.php
- [ ] ดูการเปลี่ยนแปลง stock count

---

## ⚠️ ข้อควรระวัง

1. **ตรวจสอบสินค้าที่เลือกให้ถูกต้อง** ก่อนบันทึก
2. **กรอกจำนวนให้ถูกต้อง** เพราะจะลดจากสต็อกทันที
3. **เพิ่มหมายเหตุเพื่ออ้างอิง** ในอนาคต
4. **ลบรายการต้องยืนยัน** เพื่อหลีกเลี่ยงความผิดพลาด

---

## 🆘 ปัญหา & วิธีแก้ไข

### ปัญหา: สินค้าหาไม่เจอในการค้นหา
- **วิธีแก้:** ตรวจสอบสะกด SKU หรือบาร์โค้ด หรือลองค้นหาด้วยชื่อสินค้า

### ปัญหา: กดบันทึกแล้วไม่มีอะไรเกิด
- **วิธีแก้:** 
  1. ตรวจสอบคอนโซล (F12) ดูว่ามี error ไหม
  2. ตรวจสอบเนื้อหา input ว่า valid ไหม
  3. รีโหลดหน้า

### ปัญหา: จำนวนสูญหายไม่ตรง
- **วิธีแก้:** ลบรายการและบันทึกใหม่ด้วยจำนวนที่ถูกต้อง

---

## 📁 ไฟล์ที่เกี่ยวข้อง

### Frontend Pages
- `stock/missing_products.php` - หน้าบันทึก
- `stock/missing_products_list.php` - หน้าดูรายการ

### API Endpoints
- `api/missing_product_search_api.php` - ค้นหา
- `api/record_missing_product_api.php` - บันทึก
- `api/get_missing_products_api.php` - ดูรายการ
- `api/delete_missing_product_api.php` - ลบ

### Setup
- `setup_missing_products_table.php` - สร้างตาราง

### Documentation
- `MISSING_PRODUCTS_SYSTEM.md` - เอกสารเทคนิค

---

## 📞 ติดต่อ Support
หากมีปัญหา ติดต่อ Admin หรือ IT Support
