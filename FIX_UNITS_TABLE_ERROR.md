# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: Table 'units' doesn't exist

## ‚úÖ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö
- ‡πÑ‡∏ü‡∏•‡πå `cancelled_items.php` ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 52 ‡πÉ‡∏ä‡πâ `LEFT JOIN units un ON poi.unit_id = un.unit_id`
- Table `units` ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- Error: `SQLSTATE[42S02]: Base table or view not found: 1146 Table 'ichoice_.units' doesn't exist`

## üîß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡∏•‡∏ö JOIN ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
**‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å:**
```sql
LEFT JOIN units un ON poi.unit_id = un.unit_id
LEFT JOIN currencies c ON po.currency_id = c.currency_id
```

**‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô:**
```sql
COALESCE(poi.unit, '‡∏´‡∏ô‡πà‡∏ß‡∏¢') as unit_name,
'THB' as currency_code
```

### ‡∏•‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô
**‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å:**
```sql
po.po_id,  -- ‡∏ã‡πâ‡∏≥
poi.unit_id,
un.name as unit_name,
c.code as currency_code
```

**‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô:**
```sql
COALESCE(poi.unit, '‡∏´‡∏ô‡πà‡∏ß‡∏¢') as unit_name,
'THB' as currency_code
```

### ‡∏•‡∏î‡∏£‡∏π‡∏õ GROUP BY
**‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å:**
```sql
GROUP BY poi.item_id, poi.po_id, po.po_number, s.name, p.product_id, p.name, p.code, 
         poi.qty, poi.cancel_qty, poi.is_cancelled, poi.is_partially_cancelled, 
         poi.cancel_reason, poi.cancel_notes, poi.cancelled_at, u.firstname, u.lastname, 
         poi.unit_id, un.name, poi.unit_price, c.code
```

**‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô:**
```sql
GROUP BY poi.item_id
```

## üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

1. ‚úÖ ‡∏•‡∏ö JOIN ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á (units, currencies)
2. ‚úÖ ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ó‡∏ô (`COALESCE(poi.unit, '‡∏´‡∏ô‡πà‡∏ß‡∏¢')`)
3. ‚úÖ ‡∏•‡∏î‡∏£‡∏π‡∏õ GROUP BY ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢
4. ‚úÖ ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô

## üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `test_cancelled_schema.php` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö query

## ‚ú® ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á
- ‡∏´‡∏ô‡πâ‡∏≤ `cancelled_items.php` ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ error
- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á:
  - ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
  - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏±‡πà‡∏á ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏±‡∏ö ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
  - ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏£‡∏≤‡∏Ñ‡∏≤
  - ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
  - ‡∏ú‡∏π‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
