# Data Flow Diagram: Expiry Date Saving

## ğŸ”„ à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER INTERFACE (Browser)                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Edit Modal Form                                          â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚ Remark:        [_______________________]                â”‚       â”‚
â”‚  â”‚ Price:         [_______________________]                â”‚       â”‚
â”‚  â”‚ Qty:           [_______________________]                â”‚       â”‚
â”‚  â”‚ Expiry Date:   [_______________________]  â† KEY INPUT   â”‚       â”‚
â”‚  â”‚ Location:      [_______________________]                â”‚       â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚       â”‚
â”‚  â”‚ â”‚      Cancel      â”‚    â”‚      Save        â”‚           â”‚       â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                           â†“                                         â”‚
â”‚              ğŸ“‹ jQuery serialize()                                  â”‚
â”‚                           â†“                                         â”‚
â”‚   LOG ğŸ“: === FORM DATA BEING SENT ===                             â”‚
â”‚   expiry_date field value: 2025-12-31                             â”‚
â”‚   expiry_date key exists: yes                                      â”‚
â”‚                           â†“                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    HTTP POST Request
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. BACKEND (PHP - receive_edit.php)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ Parse POST Data                     â”‚                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  â”‚ $_POST['receive_id']    = 43        â”‚                           â”‚
â”‚  â”‚ $_POST['expiry_date']   = "2025-..." â”‚ â† CAPTURED              â”‚
â”‚  â”‚ $_POST['remark']        = "..."     â”‚                           â”‚
â”‚  â”‚ $_POST['quantity']      = 5         â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                           â†“                                         â”‚
â”‚  LOG ğŸ“: === RECEIVE_EDIT START ===                                â”‚
â”‚  expiry_date raw: 'string' (10) "2025-12-31"                      â”‚
â”‚  expiry_date is_empty_string: no                                   â”‚
â”‚  POST keys: receive_id, remark, expiry_date, ...                  â”‚
â”‚                           â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ Check if Split or Normal Update     â”‚                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  â”‚ if $is_split:                       â”‚                           â”‚
â”‚  â”‚   â†’ handleQuantitySplit()           â”‚                           â”‚
â”‚  â”‚ else:                               â”‚                           â”‚
â”‚  â”‚   â†’ Normal UPDATE query             â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                           â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ SQL Query (Normal Update)           â”‚                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  â”‚ UPDATE receive_items                â”‚                           â”‚
â”‚  â”‚ SET remark=?,                       â”‚                           â”‚
â”‚  â”‚     receive_qty=?,                  â”‚                           â”‚
â”‚  â”‚     expiry_date=?  â† FROM POST DATA â”‚                           â”‚
â”‚  â”‚ WHERE receive_id=?                  â”‚                           â”‚
â”‚  â”‚                                     â”‚                           â”‚
â”‚  â”‚ Parameters:                         â”‚                           â”‚
â”‚  â”‚ [1] remark value                    â”‚                           â”‚
â”‚  â”‚ [2] qty value                       â”‚                           â”‚
â”‚  â”‚ [3] expiry_date = "2025-12-31"  âœ… â”‚                           â”‚
â”‚  â”‚ [4] receive_id = 43                 â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                           â†“                                         â”‚
â”‚  LOG ğŸ“: Normal update executed.                                   â”‚
â”‚  Expiry_date: 'string' (10) "2025-12-31"                          â”‚
â”‚  Rows affected: 1                                                   â”‚
â”‚                           â†“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ Commit Transaction                  â”‚                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  â”‚ $pdo->commit()                      â”‚                           â”‚
â”‚  â”‚ âœ… Changes saved!                   â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                           â†“                                         â”‚
â”‚  Return JSON: {"success": true}                                    â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    HTTP Response
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. DATABASE (MySQL)                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  receive_items Table                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚receive_idâ”‚item_id  â”‚po_id   â”‚receive_qty   â”‚expiry_date   â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚42        â”‚55       â”‚33      â”‚5.00          â”‚2025-11-30    â”‚     â”‚
â”‚  â”‚43        â”‚55       â”‚33      â”‚5.00          â”‚2025-12-31 âœ… â”‚â† NEW â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                       â”‚
â”‚  âœ… expiry_date successfully updated!                              â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. BROWSER (UI Update)                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  âœ… SweetAlert: "à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ"                                      â”‚
â”‚  ğŸ“‹ Table refreshes                                                 â”‚
â”‚  ğŸ“Š Show updated expiry_date in table                               â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: Data Flow à¹à¸ªà¸”à¸‡à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”

### ğŸ“ Frontend Form
```html
<input type="date" class="form-control" name="expiry_date" id="edit-expiry-date" value="2025-12-31">
```

### ğŸ“¤ jQuery Serialize
```javascript
let formData = $('#edit-form').serialize();
// Result:
// "receive_id=43&remark=...&expiry_date=2025-12-31&price_per_unit=100&..."
```

### ğŸ“¥ PHP Receive
```php
$_POST['expiry_date'] = '2025-12-31';
$expiry_date = isset($_POST['expiry_date']) ? $_POST['expiry_date'] : null;
// Result: $expiry_date = '2025-12-31'
```

### ğŸ” SQL Binding
```php
$sql = "UPDATE receive_items SET ... expiry_date=? WHERE receive_id=?";
$stmt->execute([$remark, $receive_qty, $expiry_date, $receive_id]);
// Binds: expiry_date = '2025-12-31', receive_id = 43
```

### ğŸ’¾ Database Result
```sql
SELECT * FROM receive_items WHERE receive_id = 43;
-- Returns: expiry_date = '2025-12-31'
```

---

## âš ï¸ à¸ˆà¸¸à¸”à¸—à¸µà¹ˆà¸­à¸²à¸ˆà¹€à¸à¸´à¸”à¸›à¸±à¸à¸«à¸²

```
1. Form Input Empty?
   â””â”€ expiry_date field à¸§à¹ˆà¸²à¸‡
   â””â”€ User à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸à¸£à¸­à¸
   â””â”€ API return empty value

2. Form Field Not in Form?
   â””â”€ HTML structure wrong
   â””â”€ Field outside <form> tag
   â””â”€ jQuery selector wrong

3. Serialize Not Working?
   â””â”€ Field doesn't have name attribute
   â””â”€ jQuery library not loaded
   â””â”€ Field disabled

4. POST Data Lost?
   â””â”€ $_POST superglobal issue
   â””â”€ Request method wrong
   â””â”€ CORS or proxy issue

5. SQL Query Failed?
   â””â”€ Column type mismatch
   â””â”€ Database error
   â””â”€ Transaction rollback

6. Data Not Persisted?
   â””â”€ Database not committed
   â””â”€ Read replica lag
   â””â”€ Connection lost
```

---

## ğŸ› ï¸ Debug Points Added

### Browser Console (4 logs)
```javascript
console.log('=== FORM DATA BEING SENT ===');  // 1. marker
console.log('Form serialized data:', formData);  // 2. full data
console.log('Expiry date field value:', $('#edit-expiry-date').val());  // 3. value
console.log('Expiry date field exists:', $('#edit-expiry-date').length > 0);  // 4. exists check
```

### PHP Backend (7 logs)
```php
error_log("=== RECEIVE_EDIT START ===");  // 1. marker
error_log("expiry_date raw: " . var_export($expiry_date, true));  // 2. raw value
error_log("expiry_date is_empty_string: " . ($expiry_date === '' ? 'yes' : 'no'));  // 3. empty check
error_log("POST expiry_date key exists: " . (isset($_POST['expiry_date']) ? 'yes' : 'no'));  // 4. key check
error_log("FULL POST: " . json_encode($_POST));  // 5. full POST
error_log("Normal update executed. Expiry_date: " . var_export($expiry_date, true) . ", Rows affected: " . $stmt->rowCount());  // 6. update result
// Plus split-specific logs (7-11)
```

---

## ğŸ“Š Expected vs Actual

### âœ… Expected Flow
```
User enters 2025-12-31 
    â†“ 
Form sends: expiry_date=2025-12-31 
    â†“ 
PHP receives: $_POST['expiry_date'] = '2025-12-31' 
    â†“ 
Query executes: SET expiry_date='2025-12-31' 
    â†“ 
Database saves: expiry_date = 2025-12-31 
    â†“ 
âœ… Success!
```

### âŒ Current Issue
```
User enters 2025-12-31 
    â†“ 
Form sends: ??? (need to check) 
    â†“ 
PHP receives: $_POST['expiry_date'] = ??? (need to check) 
    â†“ 
Query executes: ??? (need to check) 
    â†“ 
Database saves: expiry_date = NULL 
    â†“ 
âŒ Failed! Need debug logs to identify step.
```

---

## ğŸ”§ How to Read Debug Output

### Console.log Output âœ…
```
Browser Console â†’ Find "=== FORM DATA BEING SENT ===" 
Below it:
- Form serialized data: receive_id=43&expiry_date=2025-12-31&...
- Expiry date field value: 2025-12-31
- Expiry date field exists: true
```

### Error.log Output âœ…
```
PHP Error Log â†’ Find "=== RECEIVE_EDIT START ===" 
Below it:
- receive_id: 43
- expiry_date raw: 'string' (10) "2025-12-31"
- POST expiry_date key exists: yes
- Normal update executed. Rows affected: 1
```

### Database Query âœ…
```sql
SELECT * FROM receive_items WHERE receive_id = 43;
Result: expiry_date = 2025-12-31
```

---

**Created:** 2025-11-20  
**Purpose:** Visual guide for data flow debugging  
**Status:** Ready for use
