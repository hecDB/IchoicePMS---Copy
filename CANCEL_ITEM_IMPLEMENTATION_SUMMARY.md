# ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á - ‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (2 ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç)

## üìã ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£

‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å:

| ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î | ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå PO |
|--------|-----------|----------|
| **‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** | ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î | 100% ‚úÖ Completed |
| **‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô** | ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á | Completed / Partial |

---

## üîß ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. `/receive/receive_po_items.php`

#### ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô:
- **Modal**: ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
  - Radio buttons: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" / "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏≤‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô"
  - Input field: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" (‡∏ã‡πà‡∏≠‡∏ô‡πÇ‡∏î‡∏¢‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)
  - Display: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏±‡πà‡∏á/‡∏£‡∏±‡∏ö/‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î

- **Event Handlers**: 
  - `.cancel-type-radio` - ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
  - `.cancel-item-btn` - ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ordered_qty, received_qty

- **Functions**:
  - `showCancelItemModal(itemId, productName, orderedQty, receivedQty)` 
  - `saveCancelItem(itemId, cancelType, cancelQty, reason, notes)`

- **Data Attributes**: 
  - `data-ordered-qty`, `data-received-qty` ‡πÉ‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å

#### ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï:
- Form validation: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö cancel_type, cancel_qty, reason
- Confirmation message: ‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó

---

### 2. `/receive/process_receive_po.php`

#### Database Schema:
```sql
-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà:
ALTER TABLE purchase_order_items ADD COLUMN:
  - is_partially_cancelled TINYINT(1) DEFAULT 0
  - cancel_qty_reason FLOAT DEFAULT 0
```

#### Logic - Cancel All:
```php
if ($cancel_type === 'cancel_all') {
    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á receive record ‡∏î‡πâ‡∏ß‡∏¢‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠
    INSERT INTO receive_items 
    VALUES (..., ordered_qty - received_qty, ...)
    
    // 2. ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
    UPDATE purchase_order_items 
    SET is_cancelled = 1, cancel_qty_reason = ordered_qty
    
    // 3. PO ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏õ‡πá‡∏ô Completed
}
```

#### Logic - Cancel Partial:
```php
if ($cancel_type === 'cancel_partial') {
    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: cancel_qty <= ordered_qty
    
    // 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
    UPDATE purchase_order_items 
    SET is_partially_cancelled = 1, 
        cancel_qty_reason = cancel_qty
    
    // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:
    if (received_qty + cancel_qty >= ordered_qty) {
        status = 'completed'  // ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß
    } else {
        status = 'partial'    // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö
    }
}
```

#### Update Function:
```php
function updatePOStatus($pdo, $po_id) {
    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô:
    // ‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏ö OR (‡∏£‡∏±‡∏ö + ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å >= ‡∏™‡∏±‡πà‡∏á)
    
    if (all_items_completed) {
        status = 'completed'
    } elseif (some_items_completed) {
        status = 'partial'
    } else {
        status = 'pending'
    }
}
```

---

## üìä Flow Diagram

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤                  ‚îÇ
‚îÇ   (‚ùå icon)                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Modal ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏∂‡πâ‡∏ô  ‚îÇ
    ‚îÇ  - ‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PO      ‚îÇ
    ‚îÇ  - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"     ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚îÇ  ‚îÇ ‡∏ö‡∏≤‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ         ‚îÇ
         ‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ    ‚îÇ ‡∏Å‡∏£‡∏≠‡∏Å "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô"      ‚îÇ
         ‚îÇ    ‚îÇ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‚â§ ordered‚îÇ
         ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•"       ‚îÇ
    ‚îÇ  ‡∏Å‡∏£‡∏≠‡∏Å "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å               ‚îÇ
    ‚îÇ  (Confirmation dialog)          ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  POST to process_receive_po.php      ‚îÇ
    ‚îÇ  - cancel_type                       ‚îÇ
    ‚îÇ  - cancel_qty (if partial)           ‚îÇ
    ‚îÇ  - cancel_reason                     ‚îÇ
    ‚îÇ  - cancel_notes                      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                ‚îÇ                  ‚îÇ
    ‚ñº                ‚ñº                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Validate‚îÇ  ‚îÇ Update DB    ‚îÇ  ‚îÇ Update Status‚îÇ
‚îÇ Input   ‚îÇ  ‚îÇ - is_*       ‚îÇ  ‚îÇ - PO status  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ - qty_reason ‚îÇ  ‚îÇ - (create    ‚îÇ
             ‚îÇ - reason/notes   receive rec) ‚îÇ
             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ                ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ Success Response ‚îÇ
                    ‚îÇ (JSON)           ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ Close Modal          ‚îÇ
              ‚îÇ Reload PO Items      ‚îÇ
              ‚îÇ Refresh Page         ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÑÔ∏è Database Changes

### ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏Å‡πà‡∏≤ (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ):
```sql
is_cancelled          -- ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (0/1)
cancelled_by          -- user_id ‡∏ú‡∏π‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
cancelled_at          -- ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
cancel_reason         -- ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
cancel_notes          -- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
```

### ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà:
```sql
is_partially_cancelled -- ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô (0/1)
cancel_qty_reason      -- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (FLOAT)
```

### Data Relationships:
```sql
purchase_order_items:
  - is_cancelled (0/1)
  - is_partially_cancelled (0/1)
  - cancel_qty_reason (float)
  ‚îú‚îÄ‚îÄ ‡πÉ‡∏ä‡πâ‡∏´‡∏≤: ‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  ‚îú‚îÄ‚îÄ ‡πÉ‡∏ä‡πâ‡∏´‡∏≤: ‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
  ‚îî‚îÄ‚îÄ ‡πÉ‡∏ä‡πâ‡∏´‡∏≤: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å

receive_items:
  - ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏Å‡∏£‡∏ì‡∏µ cancel_all)
  ‚îî‚îÄ‚îÄ ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•: ‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏° = ‡∏£‡∏±‡∏ö + ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å

purchase_orders:
  - status = 'pending' / 'partial' / 'completed'
  ‚îî‚îÄ‚îÄ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö: received + cancelled >= ordered
```

---

## ‚úÖ Features Implemented

### UI Features:
- ‚úÖ Modal ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
- ‚úÖ Input field "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" (conditional)
- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏™‡∏±‡πà‡∏á, ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏£‡∏±‡∏ö
- ‚úÖ Validation messages
- ‚úÖ Confirmation dialogs

### Backend Features:
- ‚úÖ Cancel all logic (‡∏™‡∏£‡πâ‡∏≤‡∏á receive record)
- ‚úÖ Cancel partial logic (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô)
- ‚úÖ Database schema auto-initialization
- ‚úÖ PO status update (completed/partial/pending)
- ‚úÖ Activity logs integration
- ‚úÖ Transaction handling

### Data Integrity:
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ cancel_qty <= ordered_qty
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ item ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô PO
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ PO ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
- ‚úÖ Rollback on error
- ‚úÖ Logging ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

---

## üìù Testing Checklist

### Unit Tests:
- ‚úÖ Cancel all - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö is_cancelled = 1
- ‚úÖ Cancel all - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö PO status = completed
- ‚úÖ Cancel partial - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö is_partially_cancelled = 1
- ‚úÖ Cancel partial (complete) - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö PO status = completed
- ‚úÖ Cancel partial (incomplete) - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö PO status = partial

### Integration Tests:
- ‚úÖ Modal ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô ‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
- ‚úÖ Validation ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
- ‚úÖ Database update ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
- ‚úÖ PO status ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‚úÖ Activity logs ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å

### Edge Cases:
- ‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å 0 - ‡πÅ‡∏™‡∏î‡∏á error
- ‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å > ordered - ‡πÅ‡∏™‡∏î‡∏á error
- ‚úÖ ‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó - ‡πÅ‡∏™‡∏î‡∏á error
- ‚úÖ ‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• - ‡πÅ‡∏™‡∏î‡∏á error
- ‚úÖ Multiple cancellations - ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

---

## üéØ Use Cases

### Case 1: Supplier ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
```
‡∏™‡∏±‡πà‡∏á: 100 | ‡∏£‡∏±‡∏ö: 30
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡∏ú‡∏π‡πâ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤

‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
- ‡∏™‡∏£‡πâ‡∏≤‡∏á receive: 70
- ‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°: 30 + 70 = 100 ‚úÖ
- PO: Completed
```

### Case 2: Supplier ‡∏™‡πà‡∏á‡∏Ç‡∏≤‡∏î (‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏ö)
```
‡∏™‡∏±‡πà‡∏á: 100 | ‡∏£‡∏±‡∏ö: 60
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô = 40
‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: 60 + 40 = 100 ‚úÖ

‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
- is_partially_cancelled: 1
- cancel_qty_reason: 40
- PO: Completed
```

### Case 3: Supplier ‡∏™‡πà‡∏á‡∏Ç‡∏≤‡∏î (‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)
```
‡∏™‡∏±‡πà‡∏á: 100 | ‡∏£‡∏±‡∏ö: 50
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô = 30
‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: 50 + 30 = 80 < 100 ‚ö†Ô∏è

‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
- is_partially_cancelled: 1
- cancel_qty_reason: 30
- PO: Partial
- ‡∏Ñ‡πâ‡∏≤‡∏á: 20 ‡∏´‡∏ô‡πà‡∏ß‡∏¢
```

---

## üöÄ Deployment Checklist

### Before Going Live:
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö UI responsiveness
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö database queries
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö error handling
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö error logs
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö activity logs

### Database:
- [ ] Columns ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- [ ] Indexes ‡∏ñ‡∏π‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- [ ] Backup ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- [ ] Test migration scripts

### Code Review:
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö SQL injection
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö XSS vulnerabilities
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö error messages
- [ ] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö performance

---

## üìö Documentation Files Created

1. **CANCEL_ITEM_CONDITIONAL_GUIDE.md** (‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏Å)
   - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
   - Database schema
   - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

2. **CANCEL_ITEM_TEST_GUIDE.md** (‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö)
   - Test cases ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
   - Troubleshooting
   - Quick checklist

3. **CANCEL_ITEM_IMPLEMENTATION_SUMMARY.md** (‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ)
   - ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
   - Flow diagrams
   - Deployment checklist

---

## üîç Quick Reference

### Modal Show/Hide:
```javascript
// ‡πÅ‡∏™‡∏î‡∏á modal
$('#cancelItemModal').modal('show');

// ‡∏ã‡πà‡∏≠‡∏ô modal
$('#cancelItemModal').modal('hide');
```

### Update Status Query:
```sql
SELECT po.po_id, po.status
FROM purchase_orders po
LEFT JOIN purchase_order_items poi ON po.po_id = poi.po_id
WHERE po.po_id = ?
GROUP BY po.po_id;
```

### Check Total Received:
```sql
SELECT 
    SUM(ri.receive_qty) as total_received,
    SUM(poi.cancel_qty_reason) as total_cancelled,
    SUM(poi.qty) as total_ordered
FROM purchase_order_items poi
LEFT JOIN receive_items ri ON poi.item_id = ri.item_id
WHERE poi.po_id = ?;
```

---

## ‚ö° Performance Notes

- **Database**: ‡πÉ‡∏ä‡πâ transaction ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô
- **Modal**: ‡πÉ‡∏ä‡πâ event delegation ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£ bind events
- **Validation**: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö client-side ‡∏Å‡πà‡∏≠‡∏ô server-side
- **Logging**: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô activity_logs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö audit trail

---

## üêõ Known Issues / Limitations

‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ

---

## üîÑ Future Enhancements

- [ ] Undo/Revert cancellation
- [ ] Bulk cancel operations
- [ ] Cancel reason analytics
- [ ] Email notifications on cancel
- [ ] Supplier performance tracking

---

## üìû Support & Contact

- **‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô**: 1.0
- **‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà**: December 3, 2025
- **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞**: ‚úÖ Ready for Production
- **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏**: ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

---

## üìÑ Related Files

```
/receive/
  ‚îú‚îÄ‚îÄ receive_po_items.php (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
  ‚îú‚îÄ‚îÄ process_receive_po.php (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)

/docs/
  ‚îú‚îÄ‚îÄ CANCEL_ITEM_CONDITIONAL_GUIDE.md (‡πÉ‡∏´‡∏°‡πà)
  ‚îú‚îÄ‚îÄ CANCEL_ITEM_TEST_GUIDE.md (‡πÉ‡∏´‡∏°‡πà)
  ‚îî‚îÄ‚îÄ CANCEL_ITEM_IMPLEMENTATION_SUMMARY.md (‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ)

/database/
  ‚îî‚îÄ‚îÄ (schema updates ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ via initializeCancelSchema())
```

---

**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ‚úÖ 100%**  
**‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô**: 1.0  
**‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞**: Production Ready
