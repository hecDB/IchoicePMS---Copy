<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö PO ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f8fafc; }
        .container { max-width: 1000px; margin: 0 auto; }
        .test-section { background: white; padding: 20px; margin: 20px 0; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .po-item { background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin: 10px 0; }
        .po-item.oldest { border: 2px solid #3b82f6; background: #f0f7ff; }
        .badge { background: #3b82f6; color: white; padding: 5px 10px; border-radius: 12px; font-size: 12px; }
        .badge.auto { background: #10b981; }
        .badge.manual { background: #f59e0b; }
        .text-primary { color: #3b82f6; }
        .text-success { color: #10b981; }
        .text-warning { color: #f59e0b; }
        .text-muted { color: #6b7280; }
        .fw-bold { font-weight: bold; }
        .small { font-size: 0.875rem; }
        .d-flex { display: flex; }
        .justify-content-between { justify-content: space-between; }
        .align-items-center { align-items: center; }
        .row { display: flex; gap: 15px; margin: 10px 0; }
        .col { flex: 1; text-align: center; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; margin: 5px; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-success { background: #10b981; color: white; }
        .sort-info { background: #fef3c7; padding: 10px; border-radius: 6px; margin: 10px 0; }
        .result-info { background: #dbeafe; padding: 10px; border-radius: 6px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö PO ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà</h1>
        <p class="text-muted">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà+‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞ Secondary Sort ‡∏î‡πâ‡∏ß‡∏¢ PO Number</p>

        <div class="test-section">
            <h3>‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <div class="row">
                <button class="btn btn-primary" onclick="testSameDayDifferentTime()">
                    Case 1: ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
                </button>
                <button class="btn btn-primary" onclick="testSameDateTimeNoPONumber()">
                    Case 2: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà+‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (‡πÉ‡∏ä‡πâ PO Number)
                </button>
                <button class="btn btn-primary" onclick="testMixedDates()">
                    Case 3: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô (Mixed)
                </button>
                <button class="btn btn-success" onclick="testRealWorldScenario()">
                    Case 4: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á
                </button>
            </div>
        </div>

        <div id="results" class="test-section" style="display: none;">
            <h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <div id="sortInfo"></div>
            <div id="resultsContent"></div>
        </div>
    </div>

    <script>
        // Mock data with different scenarios
        const mockDataSets = {
            sameDayDifferentTime: {
                product_name: "‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡∏•‡∏π‡∏Å‡∏•‡∏∑‡πà‡∏ô",
                sku: "PEN001",
                purchase_orders: [
                    {
                        po_number: "PO-003",
                        order_date: "2025-01-15 14:30:00", // ‡∏ö‡πà‡∏≤‡∏¢ 2:30
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ABC",
                        remaining_qty: 50
                    },
                    {
                        po_number: "PO-001", 
                        order_date: "2025-01-15 08:00:00", // ‡πÄ‡∏ä‡πâ‡∏≤ 8:00
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó XYZ",
                        remaining_qty: 30
                    },
                    {
                        po_number: "PO-002",
                        order_date: "2025-01-15 11:15:00", // ‡∏™‡∏≤‡∏¢ 11:15
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó DEF",
                        remaining_qty: 80
                    }
                ]
            },
            sameDateTimeNoPONumber: {
                product_name: "‡∏î‡∏¥‡∏ô‡∏™‡∏≠ HB",
                sku: "PENCIL001", 
                purchase_orders: [
                    {
                        po_number: "PO-105",
                        order_date: "2025-01-15 10:00:00", // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó GHI",
                        remaining_qty: 100
                    },
                    {
                        po_number: "PO-102",
                        order_date: "2025-01-15 10:00:00", // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó JKL",
                        remaining_qty: 70
                    },
                    {
                        po_number: "PO-108",
                        order_date: "2025-01-15 10:00:00", // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó MNO",
                        remaining_qty: 45
                    }
                ]
            },
            mixedDates: {
                product_name: "‡∏¢‡∏≤‡∏á‡∏•‡∏ö",
                sku: "ERASER001",
                purchase_orders: [
                    {
                        po_number: "PO-201",
                        order_date: "2025-01-12 16:45:00", // 3 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó PQR",
                        remaining_qty: 25
                    },
                    {
                        po_number: "PO-205",
                        order_date: "2025-01-15 09:30:00", // ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ä‡πâ‡∏≤
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó STU",
                        remaining_qty: 60
                    },
                    {
                        po_number: "PO-203",
                        order_date: "2025-01-10 14:20:00", // 5 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó VWX",
                        remaining_qty: 90
                    }
                ]
            },
            realWorld: {
                product_name: "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4",
                sku: "PAPER-A4-001",
                purchase_orders: [
                    {
                        po_number: "PO-2025-001",
                        order_date: "2025-01-01 09:00:00", // ‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏†‡∏±‡∏ì‡∏ë‡πå",
                        remaining_qty: 200
                    },
                    {
                        po_number: "PO-2025-015",
                        order_date: "2025-01-15 08:30:00", // ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ä‡πâ‡∏≤
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå ‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏•‡∏î‡πå",
                        remaining_qty: 150
                    },
                    {
                        po_number: "PO-2025-015-B",
                        order_date: "2025-01-15 08:30:00", // ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡πà PO Number ‡∏ï‡πà‡∏≤‡∏á
                        supplier_name: "‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå ‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏•‡∏î‡πå",
                        remaining_qty: 100
                    }
                ]
            }
        };

        function testSameDayDifferentTime() {
            const data = mockDataSets.sameDayDifferentTime;
            const sortInfo = "üïê ‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ‚Üí ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏ä‡πâ‡∏≤ ‚Üí ‡∏ö‡πà‡∏≤‡∏¢)";
            const expected = "‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: PO-001 (08:00) ‚Üí PO-002 (11:15) ‚Üí PO-003 (14:30)";
            testSorting(data, "Case 1: ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô", sortInfo, expected);
        }

        function testSameDateTimeNoPONumber() {
            const data = mockDataSets.sameDateTimeNoPONumber;
            const sortInfo = "üî§ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà+‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‚Üí ‡πÉ‡∏ä‡πâ Secondary Sort (PO Number)";
            const expected = "‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: PO-102 ‚Üí PO-105 ‚Üí PO-108 (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° PO Number)";
            testSorting(data, "Case 2: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà+‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô", sortInfo, expected);
        }

        function testMixedDates() {
            const data = mockDataSets.mixedDates;
            const sortInfo = "üìÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏Å‡πà‡∏≤ ‚Üí ‡πÉ‡∏´‡∏°‡πà)";
            const expected = "‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: PO-203 (01/10) ‚Üí PO-201 (01/12) ‚Üí PO-205 (01/15)";
            testSorting(data, "Case 3: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô", sortInfo, expected);
        }

        function testRealWorldScenario() {
            const data = mockDataSets.realWorld;
            const sortInfo = "üåç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á (Mixed Date + Same DateTime + Secondary Sort)";
            const expected = "‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: PO-2025-001 (01/01) ‚Üí PO-2025-015 (01/15 ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô) ‚Üí PO-2025-015-B";
            testSorting(data, "Case 4: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á", sortInfo, expected);
        }

        function testSorting(productData, caseTitle, sortInfo, expected) {
            // Apply the same sorting logic as in quick_receive.php
            const pendingPOs = productData.purchase_orders
                .filter(po => po.remaining_qty > 0)
                .sort((a, b) => {
                    // Primary: ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
                    const dateCompare = new Date(a.order_date) - new Date(b.order_date);
                    if (dateCompare !== 0) return dateCompare;
                    
                    // Secondary: ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° PO Number (‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
                    return a.po_number.localeCompare(b.po_number);
                });

            // Check if auto-select (single product, has pending POs)
            const autoSelect = pendingPOs.length > 0;
            const selectedPO = autoSelect ? pendingPOs[0] : null;

            let html = `
                <div class="result-info">
                    <strong>${caseTitle}</strong><br>
                    <span class="badge ${autoSelect ? 'auto' : 'manual'}">${autoSelect ? 'ü§ñ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥' : 'üë§ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏á'}</span>
                    ${autoSelect ? ` ‚Üí <strong>${selectedPO.po_number}</strong>` : ''}
                </div>
                
                <div class="sort-info">
                    ${sortInfo}<br>
                    <small>${expected}</small>
                </div>
                
                <div style="margin: 15px 0;">
                    <h5>${productData.product_name} (${productData.sku})</h5>
                </div>
            `;

            pendingPOs.forEach((po, index) => {
                const isSelected = autoSelect && index === 0;
                html += `
                    <div class="po-item ${isSelected ? 'oldest' : ''}">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-bold text-primary">
                                    ${isSelected ? '‚≠ê ' : ''}${po.po_number}
                                    ${isSelected ? ' (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)' : ''}
                                </div>
                                <div class="small text-muted">${po.supplier_name}</div>
                            </div>
                            <div style="text-align: right;">
                                <div class="small text-muted">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</div>
                                <div class="small">${formatDateTime(po.order_date)}</div>
                                <div class="small fw-bold">‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${index + 1}</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <div class="small text-muted">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
                                <div class="fw-bold text-warning">${po.remaining_qty}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('sortInfo').innerHTML = '';
            document.getElementById('resultsContent').innerHTML = html;
            document.getElementById('results').style.display = 'block';
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH') + ' ' + date.toLocaleTimeString('th-TH', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        // Auto-run first test on page load
        window.onload = function() {
            testSameDayDifferentTime();
        };
    </script>
</body>
</html>