<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ทดสอบฟังก์ชันสกุลเงิน</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .currency-symbol { font-weight: bold; color: #1976d2; margin-right: 5px; }
        .price-base-display { font-size: 12px; color: #666; margin-top: 2px; }
        select, input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 15px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .product-item { background: #f9f9f9; padding: 10px; margin: 10px 0; border-radius: 6px; }
    </style>
</head>
<body>
    <h2>ทดสอบฟังก์ชันสกุลเงิน</h2>
    
    <div class="test-section">
        <h3>การเปลี่ยนสกุลเงิน</h3>
        <label>สกุลเงิน:</label>
        <select id="currencySelect">
            <option value="1" data-rate="1" data-symbol="฿">฿ บาทไทย (THB)</option>
            <option value="2" data-rate="35.5" data-symbol="$">$ ดอลลาร์สหรัฐ (USD)</option>
            <option value="3" data-rate="39.2" data-symbol="€">€ ยูโร (EUR)</option>
        </select>
        
        <div style="margin-top: 10px;">
            <label>อัตราแลกเปลี่ยน:</label>
            <input type="number" id="exchangeRate" readonly>
        </div>
    </div>

    <div class="test-section">
        <h3>รายการสินค้า</h3>
        <div id="productRows">
            <div class="product-item">
                <span>สินค้า 1 - ราคา: </span>
                <span class="currency-symbol">฿</span>
                <input type="number" class="price-input" value="100" min="0" step="0.01">
                <div class="price-base-display">≈ ฿100.00</div>
            </div>
            <div class="product-item">
                <span>สินค้า 2 - ราคา: </span>
                <span class="currency-symbol">฿</span>
                <input type="number" class="price-input" value="250" min="0" step="0.01">
                <div class="price-base-display">≈ ฿250.00</div>
            </div>
        </div>
        
        <button id="addProductBtn">เพิ่มสินค้าใหม่</button>
    </div>

    <div class="test-section">
        <h3>ราคารวม</h3>
        <div id="totalPrice" style="font-size: 18px; font-weight: bold;">รวม: ฿350.00</div>
        <div id="totalBase" style="font-size: 14px; color: #666;">เทียบเท่า: ฿350.00</div>
    </div>

    <script>
        const currencySelect = document.getElementById('currencySelect');
        const exchangeRateInput = document.getElementById('exchangeRate');
        const productRows = document.getElementById('productRows');
        let productCount = 2;

        // ฟังก์ชันอัปเดตการแสดงราคาในสกุลเงินฐาน
        function updatePriceBaseDisplay(priceInput) {
            const productItem = priceInput.closest('.product-item');
            const priceBaseDisplay = productItem.querySelector('.price-base-display');
            const price = parseFloat(priceInput.value) || 0;
            const rate = parseFloat(exchangeRateInput.value) || 1;
            const priceBase = price * rate;
            priceBaseDisplay.textContent = `≈ ฿${priceBase.toFixed(2)}`;
        }

        // ฟังก์ชันคำนวณราคารวม
        function calcTotal() {
            let sumOriginal = 0;
            const rate = parseFloat(exchangeRateInput.value) || 1;
            const selectedOption = currencySelect.options[currencySelect.selectedIndex];
            const symbol = selectedOption.dataset.symbol || '฿';
            
            document.querySelectorAll('.price-input').forEach(input => {
                const price = parseFloat(input.value) || 0;
                sumOriginal += price;
            });
            
            const sumBase = sumOriginal * rate;
            
            document.getElementById('totalPrice').textContent = `รวม: ${symbol}${sumOriginal.toFixed(2)}`;
            document.getElementById('totalBase').textContent = `เทียบเท่า: ฿${sumBase.toFixed(2)}`;
        }

        // Event listener สำหรับการเปลี่ยนสกุลเงิน
        currencySelect.addEventListener('change', function(){
            const selectedOption = this.options[this.selectedIndex];
            const rate = parseFloat(selectedOption.dataset.rate) || 1;
            const symbol = selectedOption.dataset.symbol || '฿';
            
            exchangeRateInput.value = rate.toFixed(6);
            
            // อัปเดตสัญลักษณ์ในรายการสินค้า
            document.querySelectorAll('.currency-symbol').forEach(span => {
                span.textContent = symbol;
            });
            
            // อัปเดตการแสดงราคาในสกุลเงินฐานสำหรับรายการที่มีอยู่
            document.querySelectorAll('.price-input').forEach(priceInput => {
                updatePriceBaseDisplay(priceInput);
            });
            
            calcTotal();
        });

        // Event listener สำหรับปุ่มเพิ่มสินค้าใหม่
        document.getElementById('addProductBtn').addEventListener('click', function() {
            productCount++;
            
            // ดึงสัญลักษณ์สกุลเงินปัจจุบัน
            const selectedOption = currencySelect.options[currencySelect.selectedIndex];
            const currentSymbol = selectedOption.dataset.symbol || '฿';
            
            const newProduct = document.createElement('div');
            newProduct.className = 'product-item';
            newProduct.innerHTML = `
                <span>สินค้า ${productCount} - ราคา: </span>
                <span class="currency-symbol">${currentSymbol}</span>
                <input type="number" class="price-input" value="0" min="0" step="0.01">
                <div class="price-base-display">≈ ฿0.00</div>
            `;
            
            productRows.appendChild(newProduct);
            
            // เพิ่ม event listener สำหรับ input ใหม่
            const newInput = newProduct.querySelector('.price-input');
            newInput.addEventListener('input', function() {
                updatePriceBaseDisplay(this);
                calcTotal();
            });
            
            // อัปเดตการแสดงราคาในสกุลเงินฐานสำหรับแถวใหม่
            updatePriceBaseDisplay(newInput);
            calcTotal();
        });

        // เพิ่ม event listeners สำหรับ input ที่มีอยู่แล้ว
        document.querySelectorAll('.price-input').forEach(input => {
            input.addEventListener('input', function() {
                updatePriceBaseDisplay(this);
                calcTotal();
            });
        });

        // ตั้งค่าเริ่มต้น
        currencySelect.dispatchEvent(new Event('change'));
    </script>
</body>
</html>