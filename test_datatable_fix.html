<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Test DataTables Fix</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="assets/modern-table.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Test DataTables Initialization</h2>
        
        <button id="init-table" class="btn btn-primary mb-3">Initialize Table</button>
        <button id="destroy-table" class="btn btn-danger mb-3">Destroy Table</button>
        <button id="reinit-table" class="btn btn-success mb-3">Re-initialize Table</button>
        
        <div id="console-output" class="alert alert-info mb-3" style="height: 100px; overflow-y: scroll;">
            <strong>Console Output:</strong><br>
        </div>
        
        <table id="test-table" class="table modern-table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>John Doe</td>
                    <td>john@example.com</td>
                    <td>Active</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Jane Smith</td>
                    <td>jane@example.com</td>
                    <td>Inactive</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Bob Johnson</td>
                    <td>bob@example.com</td>
                    <td>Active</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="assets/modern-table.js"></script>

    <script>
        let testTable = null;
        
        function log(message) {
            const console_output = document.getElementById('console-output');
            const time = new Date().toLocaleTimeString();
            console_output.innerHTML += `[${time}] ${message}<br>`;
            console_output.scrollTop = console_output.scrollHeight;
            console.log(message);
        }
        
        $(document).ready(function() {
            log('Document ready');
            
            $('#init-table').on('click', function() {
                try {
                    log('Attempting to initialize table...');
                    testTable = new ModernTable('test-table');
                    log('✅ Table initialized successfully');
                } catch (error) {
                    log('❌ Error initializing table: ' + error.message);
                }
            });
            
            $('#destroy-table').on('click', function() {
                try {
                    log('Attempting to destroy table...');
                    if (testTable) {
                        testTable.destroy();
                        testTable = null;
                        log('✅ Table destroyed successfully');
                    } else {
                        log('⚠️ No table instance to destroy');
                    }
                } catch (error) {
                    log('❌ Error destroying table: ' + error.message);
                }
            });
            
            $('#reinit-table').on('click', function() {
                try {
                    log('Attempting to re-initialize table...');
                    
                    // Destroy existing table first
                    if (testTable) {
                        testTable.destroy();
                        testTable = null;
                        log('Previous table destroyed');
                    }
                    
                    // Initialize new table
                    testTable = new ModernTable('test-table');
                    log('✅ Table re-initialized successfully');
                } catch (error) {
                    log('❌ Error re-initializing table: ' + error.message);
                }
            });
        });
    </script>
</body>
</html>