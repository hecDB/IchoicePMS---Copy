<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ทดสอบการแบ่งจำนวนสินค้า - IchoicePMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <span class="material-icons align-middle me-2">split_screen</span>
                        ทดสอบการแบ่งจำนวนสินค้า
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h5>คุณสมบัติใหม่: การแบ่งจำนวนสินค้าไปยัง PO หลายตัว</h5>
                        <p class="mb-0">ระบบสามารถบันทึกรายการความเคลื่อนไหวของสินค้าที่แบ่งไปยัง PO ใหม่เมื่อแก้ไขรายการรับสินค้า</p>
                    </div>
                    
                    <h5>ขั้นตอนการทดสอบ:</h5>
                    <ol>
                        <li><strong>เปิดหน้ารายการรับสินค้า:</strong> ไปที่ <code>receive_items_view.php</code></li>
                        <li><strong>คลิกปุ่มแก้ไข:</strong> เลือกรายการรับสินค้าที่ต้องการแก้ไข</li>
                        <li><strong>คลิกเปลี่ยน PO:</strong> ในหน้าแก้ไข คลิกปุ่ม "เปลี่ยน" ข้างช่องเลข PO</li>
                        <li><strong>เลือก PO ที่จำนวนไม่เพียงพอ:</strong> เลือก PO ที่มีจำนวนคงเหลือน้อยกว่าจำนวนที่ต้องการรับ</li>
                        <li><strong>ระบบจะแสดง Modal แบ่งจำนวน:</strong> กรอกจำนวนที่ต้องการแบ่งให้แต่ละ PO</li>
                        <li><strong>บันทึกข้อมูล:</strong> คลิกยืนยันการแบ่ง และบันทึกการแก้ไข</li>
                    </ol>
                    
                    <div class="mt-4">
                        <h5>คุณสมบัติที่เพิ่มเติม:</h5>
                        <ul class="list-group">
                            <li class="list-group-item">
                                <strong>บันทึกความเคลื่อนไหว:</strong> 
                                ระบบจะสร้างรายการรับสินค้าใหม่สำหรับแต่ละ PO ที่แบ่งจำนวนไป
                            </li>
                            <li class="list-group-item">
                                <strong>รักษาข้อมูลเดิม:</strong> 
                                รายการรับสินค้าเดิมจะถูกอัปเดตเป็น PO หลักด้วยจำนวนที่แบ่งให้
                            </li>
                            <li class="list-group-item">
                                <strong>ข้อมูลครบถ้วน:</strong> 
                                รายการใหม่จะมีข้อมูลผู้สร้าง วันที่ หมายเหตุ และข้อมูลอื่นๆ ครบถ้วน
                            </li>
                            <li class="list-group-item">
                                <strong>Transaction Safe:</strong> 
                                ใช้ database transaction เพื่อความปลอดภัยของข้อมูล
                            </li>
                        </ul>
                    </div>
                    
                    <div class="mt-4">
                        <h5>การตรวจสอบผลลัพธ์:</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">ตารางที่เกี่ยวข้อง</h6>
                                    </div>
                                    <div class="card-body">
                                        <ul class="mb-0">
                                            <li><code>receive_items</code> - รายการรับสินค้า</li>
                                            <li><code>purchase_order_items</code> - รายการใน PO</li>
                                            <li><code>products</code> - ข้อมูลสินค้า</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0">ฟิลด์สำคัญ</h6>
                                    </div>
                                    <div class="card-body">
                                        <ul class="mb-0">
                                            <li><code>po_id</code> - ID ของ PO</li>
                                            <li><code>item_id</code> - ID ของรายการใน PO</li>
                                            <li><code>receive_qty</code> - จำนวนที่รับ</li>
                                            <li><code>created_by</code> - ผู้สร้างรายการ</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <a href="receive_items_view.php" class="btn btn-primary btn-lg">
                            <span class="material-icons align-middle me-2">list_alt</span>
                            ไปทดสอบระบบ
                        </a>
                        <button class="btn btn-success btn-lg ms-2" onclick="checkDatabase()">
                            <span class="material-icons align-middle me-2">database</span>
                            ตรวจสอบฐานข้อมูล
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
function checkDatabase() {
    Swal.fire({
        title: 'ตรวจสอบฐานข้อมูล',
        html: `
            <div class="text-start">
                <h6>SQL สำหรับตรวจสอบ:</h6>
                <div class="alert alert-secondary">
                    <code>
                    SELECT r.receive_id, r.receive_qty, r.remark, r.created_at,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;po.po_number, p.sku, p.name as product_name<br>
                    FROM receive_items r<br>
                    LEFT JOIN purchase_orders po ON r.po_id = po.po_id<br>
                    LEFT JOIN purchase_order_items poi ON r.item_id = poi.item_id<br>
                    LEFT JOIN products p ON poi.product_id = p.product_id<br>
                    WHERE r.remark LIKE '%แบ่งจาก PO เดิม%'<br>
                    ORDER BY r.created_at DESC;
                    </code>
                </div>
                <p class="mb-0"><strong>หมายเหตุ:</strong> รายการที่มีหมายเหตุ "แบ่งจาก PO เดิม" คือรายการที่สร้างจากการแบ่งจำนวน</p>
            </div>
        `,
        width: '80%',
        confirmButtonText: 'เข้าใจแล้ว'
    });
}
</script>
</body>
</html>