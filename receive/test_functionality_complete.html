<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡πà‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</title>
    <link rel="icon" href="../images/favicon.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
    <div class="alert alert-info">
        <h4>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡πà‡∏ô‡∏´‡∏•‡∏±‡∏Å</h4>
        <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ receive_items_view.php</p>
    </div>
    
    <!-- Search Test -->
    <div class="card mb-4">
        <div class="card-header">
            <h5>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h5>
        </div>
        <div class="card-body">
            <input type="text" class="form-control" id="custom-search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á...">
            <div class="mt-2">
                <small class="text-muted">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</small>
            </div>
        </div>
    </div>
    
    <!-- Edit Button Test -->
    <div class="card mb-4">
        <div class="card-header">
            <h5>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h5>
        </div>
        <div class="card-body">
            <table id="receive-table" class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>SKU</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-id="1">
                        <td>1</td>
                        <td>TEST001</td>
                        <td>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö 1</td>
                        <td>
                            <button class="btn btn-primary btn-sm edit-btn" data-id="1">
                                <span class="material-icons">edit</span>
                                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                        </td>
                    </tr>
                    <tr data-id="2">
                        <td>2</td>
                        <td>TEST002</td>
                        <td>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö 2</td>
                        <td>
                            <button class="btn btn-primary btn-sm edit-btn" data-id="2">
                                <span class="material-icons">edit</span>
                                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Debug Log -->
    <div class="card">
        <div class="card-header">
            <h5>Debug Log</h5>
        </div>
        <div class="card-body">
            <div id="debug-log" style="height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border: 1px solid #dee2e6;"></div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="mt-4">
        <a href="receive_items_view.php" class="btn btn-success">
            <span class="material-icons">open_in_new</span>
            ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏£‡∏¥‡∏á
        </a>
        <button onclick="location.reload()" class="btn btn-secondary">
            <span class="material-icons">refresh</span>
            ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
        </button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<script>
function addLog(message) {
    const log = document.getElementById('debug-log');
    const time = new Date().toLocaleTimeString();
    log.innerHTML += `[${time}] ${message}<br>`;
    log.scrollTop = log.scrollHeight;
    console.log(message);
}

$(document).ready(function() {
    addLog('üìù Document ready - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö');
    addLog('üì¶ jQuery version: ' + $.fn.jquery);
    addLog('üìä DataTable available: ' + (typeof $.fn.DataTable));
    
    // Initialize DataTable
    let receiveTable = $('#receive-table').DataTable({
        language: {
            "search": "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤:",
            "lengthMenu": "‡πÅ‡∏™‡∏î‡∏á _MENU_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤",
            "info": "‡πÅ‡∏™‡∏î‡∏á _START_ ‡∏ñ‡∏∂‡∏á _END_ ‡∏à‡∏≤‡∏Å _TOTAL_ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
            "paginate": {
                "first": "‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å",
                "last": "‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢", 
                "next": "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ",
                "previous": "‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤"
            }
        },
        drawCallback: function() {
            addLog('üîÑ DataTable drawCallback triggered');
            bindEditButtons();
        },
        initComplete: function() {
            addLog('‚úÖ DataTable initialized successfully');
            bindEditButtons();
        }
    });
    
    function bindEditButtons() {
        addLog('üîó Binding edit buttons...');
        const editButtons = $('.edit-btn');
        addLog('üîç Found edit buttons: ' + editButtons.length);
        
        editButtons.off('click.test').on('click.test', function(e) {
            e.preventDefault();
            const id = $(this).data('id');
            addLog('‚úèÔ∏è Edit button clicked for ID: ' + id);
            
            // Show success message
            if (typeof Swal !== 'undefined') {
                Swal.fire({
                    icon: 'success',
                    title: '‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏≥‡∏á‡∏≤‡∏ô!',
                    text: 'ID: ' + id,
                    timer: 2000,
                    showConfirmButton: false
                });
            } else {
                alert('‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏≥‡∏á‡∏≤‡∏ô! ID: ' + id);
            }
        });
        
        addLog('‚úÖ Edit buttons bound successfully');
    }
    
    // Test search functionality
    $('#custom-search').on('keyup input', function() {
        const value = this.value;
        addLog('üîç Search input: "' + value + '"');
        
        if (receiveTable && typeof receiveTable.search === 'function') {
            receiveTable.search(value).draw();
            addLog('‚úÖ Search executed successfully');
        } else {
            addLog('‚ùå ERROR: receiveTable.search is not available');
        }
    });
    
    // Event delegation fallback
    $(document).on('click', '.edit-btn', function(e) {
        const id = $(this).data('id');
        addLog('üîÑ Fallback edit handler triggered for ID: ' + id);
    });
    
    addLog('üéâ All initialization complete - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö');
});
</script>

<!-- Include SweetAlert2 for better alerts -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>