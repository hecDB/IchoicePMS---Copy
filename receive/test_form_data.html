<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ทดสอบข้อมูลฟอร์มแก้ไข</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .test-section { margin: 2rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; }
        .api-result { background: #f8f9fa; padding: 1rem; border-radius: 4px; margin: 1rem 0; }
        .form-preview { background: #e8f4fd; padding: 1rem; border-radius: 4px; margin: 1rem 0; }
    </style>
</head>
<body>
    <div class="container py-4">
        <h1 class="mb-4">ทดสอบข้อมูลฟอร์มแก้ไข</h1>
        
        <div class="test-section">
            <h3>1. ทดสอบ API receive_position_api.php</h3>
            <div class="mb-3">
                <label class="form-label">ใส่ receive_id:</label>
                <input type="number" class="form-control" id="test-receive-id" placeholder="เช่น 1, 2, 3">
                <button class="btn btn-primary mt-2" onclick="testAPI()">ทดสอบ API</button>
            </div>
            <div id="api-result" class="api-result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>2. แสดงตัวอย่างฟอร์มแก้ไข</h3>
            <button class="btn btn-success" onclick="showTestForm()">แสดงตัวอย่างฟอร์ม</button>
            
            <div class="form-preview" style="display: none;" id="form-preview">
                <h5>ฟอร์มแก้ไขรายการรับสินค้า</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-2">
                            <label class="form-label">หมายเหตุ</label>
                            <input type="text" class="form-control" id="preview-remark" readonly>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">ราคาต้นทุน</label>
                            <input type="number" class="form-control" id="preview-cost" readonly>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">ราคาขายออก</label>
                            <input type="number" class="form-control" id="preview-sale" readonly>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-2">
                            <label class="form-label">จำนวน</label>
                            <input type="number" class="form-control" id="preview-qty" readonly>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">เลข PO</label>
                            <input type="text" class="form-control" id="preview-po" readonly>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">วันหมดอายุ</label>
                            <input type="date" class="form-control" id="preview-expiry" readonly>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function testAPI() {
            const receiveId = $('#test-receive-id').val();
            if (!receiveId) {
                alert('กรุณาใส่ receive_id');
                return;
            }
            
            $('#api-result').html('<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>').show();
            
            $.get('../api/receive_position_api.php', { receive_id: receiveId })
                .done(function(response) {
                    console.log('API Response:', response);
                    let html = '<h5>ผลการเรียก API:</h5>';
                    html += '<pre>' + JSON.stringify(response, null, 2) + '</pre>';
                    
                    if (response.success) {
                        html += '<div class="mt-3"><h6>ข้อมูลที่ได้รับ:</h6>';
                        html += '<ul>';
                        html += '<li>ตำแหน่ง: แถว ' + (response.row_code || 'ไม่ระบุ') + ', ล๊อค ' + (response.bin || 'ไม่ระบุ') + ', ชั้น ' + (response.shelf || 'ไม่ระบุ') + '</li>';
                        html += '<li>ราคาต้นทุน: ' + (response.price_per_unit || 'ไม่ระบุ') + ' บาท</li>';
                        html += '<li>ราคาขาย: ' + (response.sale_price || 'ไม่ระบุ') + ' บาท</li>';
                        html += '<li>หมายเหตุ: ' + (response.remark || 'ไม่มี') + '</li>';
                        html += '<li>วันหมดอายุ: ' + (response.expiry_date || 'ไม่ระบุ') + '</li>';
                        html += '</ul></div>';
                        
                        // อัพเดทฟอร์มตัวอย่าง
                        $('#preview-remark').val(response.remark || '');
                        $('#preview-cost').val(response.price_per_unit || '');
                        $('#preview-sale').val(response.sale_price || '');
                        $('#preview-po').val('PO-' + receiveId); // ตัวอย่าง
                        $('#preview-expiry').val(response.expiry_date || '');
                        $('#preview-qty').val('10'); // ตัวอย่าง
                        
                        showTestForm();
                    }
                    
                    $('#api-result').html(html);
                })
                .fail(function(xhr, status, error) {
                    console.error('API Error:', xhr, status, error);
                    $('#api-result').html('<div class="alert alert-danger">ข้อผิดพลาด: ' + error + '</div>');
                });
        }
        
        function showTestForm() {
            $('#form-preview').slideDown();
        }
        
        $(document).ready(function() {
            // ตั้งค่าเริ่มต้น
            $('#test-receive-id').val('1');
        });
    </script>
</body>
</html>